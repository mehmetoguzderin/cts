{"version":3,"sources":["../../src/webgpu/examples.spec.ts"],"names":["description","pbool","makeTestGroup","GPUTest","g","test","fn","t","unimplemented","desc","expect","shouldThrow","TypeError","shouldReject","Promise","reject","params","x","y","_result","fence","queue","createFence","signal","onCompletion","getCompletedValue","data","Uint32Array","src","device","createBuffer","mappedAtCreation","size","usage","GPUBufferUsage","COPY_SRC","COPY_DST","getMappedRange","set","unmap","expectContents","textureCompressionBC","selectDeviceOrSkipTestCase","extensions","shouldError","expectGPUError","createTexture","format","GPUTextureUsage","SAMPLED","textureCompressionETC"],"mappings":"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","sourcesContent":["export const description = `\nExamples of writing CTS tests with various features.\n\nStart here when looking for examples of basic framework usage.\n`;\n\nimport { pbool } from '../common/framework/params_builder.js';\nimport { makeTestGroup } from '../common/framework/test_group.js';\n\nimport { GPUTest } from './gpu_test.js';\n\n// To run these tests in the standalone runner, run `grunt build` or `grunt pre` then open:\n// - http://localhost:8080/?runnow=1&q=webgpu:examples:\n// To run in WPT, copy/symlink the out-wpt/ directory as the webgpu/ directory in WPT, then open:\n// - (wpt server url)/webgpu/cts.html?q=webgpu:examples:\n//\n// Tests here can be run individually or in groups:\n// - ?q=webgpu:examples:basic/async=\n// - ?q=webgpu:examples:basic/\n// - ?q=webgpu:examples:\n\nexport const g = makeTestGroup(GPUTest);\n\n// Note: spaces in test names are replaced with underscores: webgpu:examples:test_name=\n/* eslint-disable-next-line  @typescript-eslint/no-unused-vars */\ng.test('test_name').fn(t => {});\n\ng.test('not_implemented_yet,without_plan').unimplemented();\ng.test('not_implemented_yet,with_plan')\n  .desc(\n    `\nPlan for this test. What it tests. Summary of how it tests that functionality.\n- Description of cases, by describing parameters {a, b, c}\n- x= more parameters {x, y, z}\n`\n  )\n  .unimplemented();\n\ng.test('basic').fn(t => {\n  t.expect(true);\n  t.expect(true, 'true should be true');\n\n  t.shouldThrow(\n    // The expected '.name' of the thrown error.\n    'TypeError',\n    // This function is run inline inside shouldThrow, and is expected to throw.\n    () => {\n      throw new TypeError();\n    },\n    // Log message.\n    'function should throw Error'\n  );\n});\n\ng.test('basic,async').fn(async t => {\n  // shouldReject must be awaited to ensure it can wait for the promise before the test ends.\n  t.shouldReject(\n    // The expected '.name' of the thrown error.\n    'TypeError',\n    // Promise expected to reject.\n    Promise.reject(new TypeError()),\n    // Log message.\n    'Promise.reject should reject'\n  );\n\n  // Promise can also be an IIFE.\n  t.shouldReject(\n    'TypeError',\n    (async () => {\n      throw new TypeError();\n    })(),\n    'Promise.reject should reject'\n  );\n});\n\n// A test can be parameterized with a simple array of objects.\n//\n// Parameters can be public (x, y) which means they're part of the case name.\n// They can also be private by starting with an underscore (_result), which passes\n// them into the test but does not make them part of the case name:\n//\n// - webgpu:examples:basic/params={\"x\":2,\"y\":4}    runs with t.params = {x: 2, y: 5, _result: 6}.\n// - webgpu:examples:basic/params={\"x\":-10,\"y\":18} runs with t.params = {x: -10, y: 18, _result: 8}.\ng.test('basic,params')\n  .params([\n    { x: 2, y: 4, _result: 6 }, //\n    { x: -10, y: 18, _result: 8 },\n  ])\n  .fn(t => {\n    t.expect(t.params.x + t.params.y === t.params._result);\n  });\n// (note the blank comment above to enforce newlines on autoformat)\n\ng.test('gpu,async').fn(async t => {\n  const fence = t.queue.createFence();\n  t.queue.signal(fence, 2);\n  await fence.onCompletion(1);\n  t.expect(fence.getCompletedValue() === 2);\n});\n\ng.test('gpu,buffers').fn(async t => {\n  const data = new Uint32Array([0, 1234, 0]);\n  const src = t.device.createBuffer({\n    mappedAtCreation: true,\n    size: 12,\n    usage: GPUBufferUsage.COPY_SRC | GPUBufferUsage.COPY_DST,\n  });\n  new Uint32Array(src.getMappedRange()).set(data);\n  src.unmap();\n\n  // Use the expectContents helper to check the actual contents of a GPUBuffer.\n  // Like shouldReject, it must be awaited.\n  t.expectContents(src, data);\n});\n\n// One of the following two tests should be skipped on most platforms.\n\ng.test('gpu,with_texture_compression,bc')\n  .desc(\n    `Example of a test using a device descriptor.\nTests that a BC format passes validation iff the feature is enabled.`\n  )\n  .params(pbool('textureCompressionBC'))\n  .fn(async t => {\n    const { textureCompressionBC } = t.params;\n\n    if (textureCompressionBC) {\n      await t.selectDeviceOrSkipTestCase({ extensions: ['texture-compression-bc'] });\n    }\n\n    const shouldError = !textureCompressionBC;\n    t.expectGPUError(\n      'validation',\n      () => {\n        t.device.createTexture({\n          format: 'bc1-rgba-unorm',\n          size: [4, 4, 1],\n          usage: GPUTextureUsage.SAMPLED,\n        });\n      },\n      shouldError\n    );\n  });\n\ng.test('gpu,with_texture_compression,etc')\n  .desc(\n    `Example of a test using a device descriptor.\n\nTODO: Test that an ETC format passes validation iff the feature is enabled.`\n  )\n  .params(pbool('textureCompressionETC'))\n  .fn(async t => {\n    const { textureCompressionETC } = t.params;\n\n    if (textureCompressionETC) {\n      await t.selectDeviceOrSkipTestCase({\n        extensions: ['texture-compression-etc' as GPUExtensionName],\n      });\n    }\n\n    // TODO: Should actually test createTexture with an ETC format here.\n  });\n"],"file":"examples.spec.js"}